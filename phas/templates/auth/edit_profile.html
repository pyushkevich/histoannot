{% extends 'base.html' %}

{% block header %}
  {% block title %}Account Settings{% endblock %}
{% endblock %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='jquery-ui/jquery-ui.css') }}">
<script type="text/javascript" src="{{ url_for('static', filename='jquery-3.6.4.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='jquery-ui/jquery-ui.js') }}"></script>
<div id="accordion">
  <h3>Update Profile</h3>
  <div>
    <form method="post" class="pure-form pure-form-stacked">
      <fieldset>
        <div class="pure-g" style="max-width: 640px;">
          <div class="pure-u-1 pure-u-md-1-2">
            <label for="username">Username:</label>
            <input name="username" class="pure-u-23-24" type="text" id="username" value="{{username}}" readonly style="width:180pt;">
          </div>
          <div class="pure-u-1 pure-u-md-1-2">
            <label for="email">Email Address:</label>
            <input name="email" class="pure-u-23-24" type="email" id="email" value="{{email}}" required style="width:180pt;">
          </div>
          <div class="pure-u-1 pure-u-md-1-3">
            <button type="submit" class="pure-button pure-button-primary">Save Changes</button>
          </div>
          <div class="pure-u-1 pure-u-md-2-3"></div>
        </div>
      </fieldset>
    </form>
  </div>

  {% if config.HISTOANNOT_ALLOW_ORCID_LOGIN %}
  <h3>Link Account to ORCID iD</h3>
  <div>
    {% if orcid_id %}
    <p>Your account is currently linked to ORCID iD: <img src="/static/icons/id-icon.svg" width="24" height="24" alt="ORCID iD" style="vertical-align:-6px"/> <a href="https://orcid.org/{{orcid_id}}" aria-label="View ORCID record - {{orcid_id}}">{{orcid_id}}</a>.</p>
    {% if not oauth_only %}
    <p>This allows you to log in using your ORCID credentials. If you wish to unlink your account from your ORCID iD, use the button below.</p>
    <p><a href="{{url_for('auth.unlink_orcid')}}">
      <div class="pure-u-1 pure-u-md-1-3">
        <button type="submit" class="pure-button"><img src="/static/icons/id-icon.svg" alt="ORCID iD" style="height:1.1em; vertical-align:-0.175em"/> Disconnect your ORCID iD</button>
      </div>
    </a></p>
    {% endif %}
    {% else %}
    <p style="max-width: 640px;">You can link your account to your ORCID iD. This will allow you to log in using your ORCID credentials.</p>
    <p><a href="{{url_for('auth.login_with_orcid')}}">
      <div class="pure-u-1 pure-u-md-1-3">
        <button type="submit" class="pure-button"><img src="/static/icons/id-icon.svg" alt="ORCID iD" style="height:1.1em; vertical-align:-0.175em"/> Create or connect your ORCID iD</button>
      </div>
    </a></p>
    {% endif %}
  </div>
  {% endif %}

  <h3>Generate API Key</h3>
  <div>
    <p style="max-width: 640px;">If you need to interface with the server using the REST API (e.g., in a Python script), use the button below to download a JSON file containing your API key. <b>Please store this file securely</b>. A person with access to this file will have the same access to the system as someone who has your username and password.</p>

    <a href="{{url_for('auth.generate_api_key')}}" download="phas_{{username}}_api_key.json">
      <div class="pure-u-1 pure-u-md-1-3">
        <button type="submit" class="pure-button pure-button-primary">Download API Key</button>
      </div>
    </a>
  </div>
</div>

<script type="text/javascript" charset="utf8">
$(document).ready(function() {
  $("#accordion").accordion();
});
</script>

{% endblock %}

